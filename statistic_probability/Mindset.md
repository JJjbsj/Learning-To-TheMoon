
# Statistic and Probability for finance
> 统计学运用在金融量化交易里面,这个文件夹是专注于统计学的学习的.

统计学的作用就是在不确定的市场中检查我们的假设是正确,长期有优势的决策还是随机噪音.

## Preface

市场的数据并不是确定的序列,而是随机变量的实现结果

这里我来谈谈我对于数据的看法 : 
> 数据本质上就是把生活中的行为使用数据的方式记录下来
> 但是记录的数据是一个模糊的信息,而非真实明确说出来了这个行为是什么
> 数据分析的意义就是通过模型(数学模型)把数据转到一个更清晰的视角,更明确数据在表达什么
> 同时需要你个人有能力将模糊的信息转为真实有用的信息,
> 也需要有能力挖掘数据的问题,并且解决数据的问题,这个就是你获利的关键
> 我对于在量化金融领域的能力基础就是这个

美剧(Billions)里面的主角Axelrod有说过:
> There's a small group who can do the math
There's an even smaller group who can explain it.
But those few who can do both
They become billionaires.


如果学会了统计学和概率论并不能够让你盈利,你需要更多的是如何将其运用在真实的世界当中解决问题,这个是唯一能够让你有概率盈利的行为.
单纯的学习谁都会,要想要学会,并且精通运用这个就是一个问题了.

### 1(思维)

这个是建立在学习什么知识之上的,你需要了解并且懂得这个知识建立在你领域的思考方式.

#### 把"不确定性"数学化(数据化)

> 每一个价格,收益,因子,本质上都是由一个随机变量的某次行为实现的(以下是公式)

 $$ X∈R,X∼F(x) $$
- 以下是公式的解析和数学知识的挖掘,针对于数据基础差的我.(可跳过)
- x 是一个随机变量的名字.
    - 它是一个函数,把结果映射成一个数.
- ∈ 是一个符号,意思就是"属于"
    - X∈R的意思就是 : x的取值落在实数集合里.
- R 实数集合,包含所有整数,有理数,无理数
    - 实数是什么呢 = 用于描述连续数量的数
        - 凡是你在现实生活中用来测量的结果,理论都落实在实数里面
            - 长度/时间/质量/收益/温度/概率.....
                - 一根木棍的长度不一定正好是1米或1.2米 它可以是1.213456…米，而且你永远可以再多量一位
                - 这种“可以无限细分/不跳跃”的特性就是实数的核心
        - 实数集合通常记为 : R
            - 整数 = 用来“数东西”和“记方向”的数
                - 整数集合记为
                    $$ Z={…,−3,−2,−1,0,1,2,3,…} $$
                - 它是无限延伸的两端,没有上限也没有下限
                - 整数特点
                    1. 离散性 = 相邻两个整数之间没有其他整数,例如2-3之间没有整数(2.5这种碎片并不是整数)
                    2. 可加减闭合 = 两个整数相加/相减/相乘之后,依然是整数.(除法就不一定了,3÷2=1.5)
                    3. 基数于序数意义
                        - 作为基数 = 表示数量,比如vol,或者可累积的东西(波动率,仓位大小...)
                        - 作为序数 = 表示位置,顺序这种,例如交易日这种就是序数,但是它不能够告诉你价格是多少.
            - 有理数是什么呢
                1. 所有整数都是有理数(比如 5 = 5/1)
                2. 分数都是有理数(比如 2/3, -7/4)
                3. 有理数可以是有限小数(0.5 = 1/2)或者无限循环小数(0.333… = 1/3)
                - 有理数的特点
                    1. 可表示为分数$\frac{分子}{分母}$的都是有理数
                    2. 密度 = 有理数之间没有“缝隙”，无论你靠得多么近，永远看不清()
                    3. 不连续 尽管有理数之间密集，但它们并不覆盖整个实数轴。
                        - $\sqrt{2}$就不是有理数,任意尝试用分数表示都会有误差
            - 无理数是什么呢
                1. 永远无法写成分数的数/不能够精确表示成两个整数的比值
                2. 数学上典型的无理数有 : 
                    - π(圆周率) 圆的周长与直径之比
                    - $\sqrt{2}$对角线的长度比变长
                    - e(自然数) 自然指数增长
                    它们小数部分无限不循环，也就是说你永远写不完，也无法用分数精确表示
    - 数据类型
        - 离散数据 = 是可以数出来的.它的数值之间有明确的界限，你只能跳着走，不能停在半空中
            - 你收集的每日开盘/收盘就是离散的数据
        - 连续数据 = 可以量出来的 在任意两个数值之间，你永远能找到无限多个更细微的数值。它就像一条平滑的曲线，没有中断。
            - 连续的数据就相当于是每时每刻的价格变化线图
- ~ 在概率论中读作"服从/分布为"
    - 它不是运算符，而是一种符号约定，告诉你某个随机变量的统计规律。
    - $ X∼N(μ,σ2) $ = 随机变量X服从正态分布,均值为μ,方差为$σ^2$
    - 想象你在一家餐厅点餐，菜单上写了“披萨 ~ 口味选择”
        - 这里的 ~ 就像说：“披萨的口味是随机的，按照菜单上列的规则选择”
        - 在概率论里，X ~ 分布 就是说“X 的值是随机产生的，符合这个分布规则”
- F(x) 是一个函数,通常指累积分布函数(CDF),对任意实数x
    - 它描述的是随机变量 𝑋小于或等于某个值𝑥的概率
    - $F(x)=P(X≤x)$ 给你一个随机变量 $X，𝐹(𝑥)$ 告诉你 "它落在−∞到𝑥的范围内的概率有多大"
    - 性质
        1. F(x)时单调不减的,随着x增大,概率不会减少
        2. 极限值 : 
            $$\lim_{x \to -\infty} F(x) = 0, \quad \lim_{x \to +\infty} F(x) = 1$$
            - 说明概率总是在0和1之间,上面公式 = 累积分布函数F(x)的极限行为
                - 左侧 = 当x变得非常小(趋向于负无穷大)时,随机变量x小于x的概率几乎为0
                - 右侧 = 当x变得非常大(趋向于正无穷大)时,随机变量x小于x的概率几乎为1.
                    - 左侧类比 = 极低价格几乎不可能出现，所以如果你想在已经远低于历史价格的地方盈利，机会几乎为零,但这并不意味着未来不可能出现极端事件，只是累积概率非常小
                    - 右侧类比 = 相当于价格最终会覆盖所有可能的高点区间，所以总概率加起来是 1
        3. 离散vs连续
            - 离散随机变量 = F(x)时阶梯状的,每个跳跃对于一个概率.
            - 连续随机变量 = F(x)时平滑曲线,其导数就是概率密度函数$𝑓(x)=F^′(x)$
- X ∼ F(x) 随机变量x的分布有函数F(x)给出.

这些符号放在一起就是$$X ∈ ℝ, X ∼ F(x)$$
x是一个取值为实数的随机变量,并且它的概率分布由累积分布函数F(x)描述


你需要理解的不是上面的公式,而是三件事(这三件事就是反映在公式上的):
1. 随机 ≠ 无规律
    随机表示"单次结构不可预测",而不是"长期结构不存在"(一些赌博项目就是把结构偏向于庄家而非fair)
2. 分布是第一性原理
    任何统计结论，最终都在回答：“这个随机变量的分布大概长什么样？”
    - 如果你知道𝑋(随机变量)的分布，你几乎可以算出它能做的所有统计预测和分析
3. 样本只是影子
    你永远看不到F(x),只能看到样本 : $x_1​,x_2​,…,x_n​$

> 衍生出来一个问题: 
既然看不到真实分布,那么为什么要对未来下注?


---

#### 期望/方差/协方差(交易语言)
在交易的世界里面,几乎所有决策都可以翻译为三句话 : 
1. 长期能赚多少钱 ?  = 期望
$$ μ=E[X] $$
    - 随机变量 X 的期望值，也就是“X 的平均水平”
    - 离散随机变量的期望: 
        - $$E[X] = \sum_{i=1}^{n} x_i p_i$$
            1. x = 随机变量，你关心的量(目标)
            2. $x_i$ = 随机变量可能取的第i个具体值
                - 投骰子,可能取值 : $x_1=1$,$x_2=2$....,$x_6=6$
            3. $p_i​=P(X=x_i​)$ : 对应$x_i$出现的概率
            4. $\sum_{i=1}^{n}$ : 对应所有可能取值累加
                - 公式的核心就是"每个可能结果 * 发生概率,再把它们加起来"
    - 连续随机变量的期望 : 
        - $$E[X] = \int_{-\infty}^{+\infty} x f(x) \, dx$$
            - $X$ = 随机变量
            - $x$ = 随机变量可能取的值(连续的,不是离散的)
            - 
2. 结果的波动有多大 ? = 方差
$$ σ^2=E[(X−μ)^2] $$
3. 两个东西是不是"一起动的?" = 协方差
$$Cov(X,Y)=E[(X−μ_X​)(Y−μ_Y​)]$$

你要把它们理解成**行为后果**而不是数学对象。
&emsp;&emsp;一个期望为正但方差极大的策略，在有限资金和有限时间下，可能“看起来像亏钱策略”

这也就是为什么交易的绩效分析需要多个指标配合起来看.

---
#### 独立性与条件概率(因子是否"真的有效")
你需要理解什么是独立:  
$$P(X,Y)=P(X)P(Y)$$
什么是条件分布 : 
$$P(Y∣X)$$

一个关键的问题就是 : 
&emsp;&emsp;量化的世界从来不看x和y是否有相关性
而是 : 
&emsp;&emsp;在给定x发生的情况下,y的分布有没有系统性变化.

一个简单类比 : 想象市场是水流:
- 相关性只是看水位高低的平均趋势
- 条件分布则告诉你 水流的速度、波动、涨潮极端情况
- 对交易策略来说，波动和尾部更重要，平均趋势只是参考

> 思考的要点: 
如果一个因子在全样本里相关，但在分组或条件下消失，这说明了什么？

我的看法就是一个因子在整个样本里面有相关性,但是在特定的条件下,因子可能会变得失真(缺乏稳健性)

---
#### 大数定律与中心极限定理(为什么回测能够"说话")
回测之所以“有一点用”，不是因为历史会重演，而是因为：
- 大数定律会告诉你 : (强调 $n$ 趋向无穷)
$$\bar{X}_n \xrightarrow{n \to \infty} E[X]$$
&emsp;&emsp;意思 = 平均值最终会收敛到期望值
&emsp;&emsp;条件 = 样本要独立,同分布
&emsp;&emsp;回测的预期 = 希望回测收益平均能逼近未来真实期望收益.
&emsp;&emsp;但是问题是如果市场非平稳(均值在变化)或样本相关(连日收益相关)平均值不再可靠。
- 中心极限定理告诉你：
$$\sqrt{n}(\bar{X}_n - \mu) \xrightarrow{d} N(0, \sigma^2)$$
&emsp;&emsp;意思 = 样本均值的分布趋近正态分布
&emsp;&emsp;条件 = 独立,同分布
&emsp;&emsp;回测的预期 = 构建置信区间,评估策略统计显著性.
&emsp;&emsp;但是问题是收益序列自相关,波动聚集,跳跃事件常见,CLT不再严格成立,正态近似可能误导风险判断
你要理解的是适用条件，而不是背结论。
现实市场里，这些条件经常被破坏。

> 所以问题来了：
当样本不独立、不平稳时，你还能信哪些统计结论？
解答 : 
当独立和平稳条件被破坏时，不能盲目使用 LLN 和 CLT 得出的均值和置信区间。
回测的价值在于探索性分析、稳健性验证和条件风险评估，而不是“预测未来一定会重演”。

---
#### 估计的"不确定性"
任何你一个你算出来的数:
- 均值
- sharpe
- 回归系数
- ....
本身都是从有限样本里估计的随机变量，不是确定的真值。

例如样本均值 : 
$$\bar{X} \sim N(\mu, \frac{\sigma^2}{n})$$

这句话的现实含义是：
你对“策略好不好”的判断，本身就有巨大噪声。

>思考一个关键问题：
在样本量不大的情况下，如何区分“能力”和“运气”？
解答 : 
就像上面的公式意义,当样本越小,方差越大,所以唯一的方法就是增加样本.
抛五次硬币,四次正面,你会觉得硬币的偏向正面吗